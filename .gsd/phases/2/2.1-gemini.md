---
phase: 2
plan: 1
wave: 1
depends_on: []
files_modified:
  - lib/ai/gemini.ts
  - .env.local
autonomous: true
user_setup:
  - service: google_gemini
    why: "LLM and RAG capabilities"
    env_vars:
      - name: GOOGLE_API_KEY
        source: "Google AI Studio -> Get API Key"

must_haves:
  truths:
    - "Can upload file to Gemini File API"
    - "Can query Gemini using File Search"
  artifacts:
    - "lib/ai/gemini.ts exists"
---

# Plan 2.1: Gemini RAG Integration

<objective>
Implement the core Gemini service wrapper in `lib/ai/gemini.ts`.
Functionality: Upload files to Gemini Files API, and Generate Content using `models.gemini-1.5-flash` with retrieval tools.

Purpose: specific instructions to enable AI answers from docs.
Output: specific instructions to working Gemini wrapper.
</objective>

<context>
Load for context:
- .gsd/SPEC.md
- [Gemini File Search Docs](https://ai.google.dev/gemini-api/docs/file-search)
</context>

<tasks>

<task type="auto">
  <name>Install Google AI SDK</name>
  <files>package.json</files>
  <action>
    Install `@google/generative-ai` and `@google/generative-ai/files`.
  </action>
  <verify>npm list @google/generative-ai</verify>
  <done>SDKs installed</done>
</task>

<task type="auto">
  <name>Create Gemini Service</name>
  <files>lib/ai/gemini.ts</files>
  <action>
    Create `GeminiService` class/functions:
    1. `uploadFile(file: File, mimeType: string)`: Uploads to Gemini Files API.
    2. `deleteFile(name: string)`: Cleanup.
    3. `generateAnswer(query: string, fileUris: string[])`: Uses `generativeModel` with `tools: [{ fileSearch: {} }]`.
    
    Handle API Key linkage from process.env.GOOGLE_API_KEY.
  </action>
  <verify>ls lib/ai/gemini.ts</verify>
  <done>Service wrapper implemented</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Logic compiles
- [ ] Environment variable placeholder exists
</verification>
