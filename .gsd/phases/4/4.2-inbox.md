---
phase: 4
plan: 2
wave: 1
depends_on: [1]
files_modified:
  - app/dashboard/inbox/page.tsx
  - app/dashboard/inbox/[id]/page.tsx
  - components/inbox-list.tsx
  - components/agent-chat-window.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Agent can see waiting conversations"
    - "Agent can join/claim a conversation"
    - "Agent can message visitor"
  artifacts:
    - "app/dashboard/inbox/page.tsx exists"
---

# Plan 4.2: Agent Inbox

<objective>
Create the Dashboard UI for agents to manage conversations.
1. Inbox List: View all chats needing attention.
2. Chat Window: Realtime chat interface for the agent.

Purpose: specific instructions to agent UI.
Output: specific instructions to working Inbox.
</objective>

<context>
Load for context:
- .gsd/SPEC.md
</context>

<tasks>

<task type="auto">
  <name>Inbox List Page</name>
  <files>app/dashboard/inbox/page.tsx, components/inbox-list.tsx</files>
  <action>
    - `InboxList`: Server Component (initial fetch) + Client (realtime subscription to 'conversations').
    - Filter by status='waiting' or 'active'.
    - Show visitor ID, last message time, status.
    - "Claim" button -> updates status to 'active' and assigned_to to Me.
  </action>
  <verify>ls app/dashboard/inbox/page.tsx</verify>
  <done>Inbox page created</done>
</task>

<task type="auto">
  <name>Agent Chat Window</name>
  <files>app/dashboard/inbox/[id]/page.tsx, components/agent-chat-window.tsx</files>
  <action>
    - `AgentChatWindow`: Uses `useRealtimeChat`.
    - Input area sends message as role='assistant'.
    - "Close Chat" button -> status='closed'.
    - "Release" button -> status='waiting'.
  </action>
  <verify>ls app/dashboard/inbox/[id]/page.tsx</verify>
  <done>Chat window created</done>
</task>

</tasks>

<verification>
After all tasks, verify:
- [ ] Agent can see chats
- [ ] Agent can reply
</verification>
